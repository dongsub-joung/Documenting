---
title: Database Locking or Currency Control
tag: 정처기
---



[정리](https://mangkyu.tistory.com/30)

![](https://t1.daumcdn.net/cfile/tistory/99052D415A2F89440B)

### 트랜잭션의 ACID 성질

- 원자성(Atomicity): 트랜잭션에 포함된 작업은 전부 수행되거나 전부 수행되지 않아야 한다.
- 일관성(Consistency): 트랜잭션을 수행하기 전이나 후나 데이터베이스는 항상 일관된 상태를 유지해야 한다.
- 고립성(Isolation): 수행 중인 트랜잭션에 다른 트랜잭션이 끼어들어 변경중인 데이터 값을 훼손하지 않아야한다.
- 지속성(Durability): 수행을 성공적으로 완료한 트랜잭션은 변경한 데이터를 영구히 저장해야 한다.

### DBMS, 트랜잭션

- DBMS는 원자성을 유지하기 위해 회복(복구)관리자 프로그램을 작동시킴.

  일부만 진행된 트랜잭션을 취소시켜 원자성을 유지할 뿐 아니라 값을 트랜잭션 이전의 상태로 복원시켜 지속성을 유지시켜줍니다.

- DBMS는 일관성을 유지하기 위해 동시성 제어 알고리즘과 무결성 제약조건을 활용함.

- DBMS는 고립성을 유지하기 위해 동시성 제어 알고리즘을 작동시킴.

  일관성과 고립성을 유지하기 위해서 값에 동시에 접근하지 않도록 하므로 동시성 제어(Locking)를 활용하여 이를 해결

- DBMS는 지속성을 유지하기 위해 회복 관리자 프로그램을 이용함.

![](https://t1.daumcdn.net/cfile/tistory/994CAA425A2F96501C)



![](https://t1.daumcdn.net/cfile/tistory/99F5A8435A2F9A6F1E)



---

### Currency Control, 동시성 제어 미보장시 문제점

#### Lost Update, 갱신 손실

- 하나의 트랜잭션이 갱신한 내용을 다른 트랜잭션이 덮어씀으로써 갱신이 무효화가 되는 것을 의미
- 두 개의 트랜잭션이 한 개의 데이터를 동시에 갱신(Update)할 때 발생
- 데이터베이스에서 절대 발생하면 안되는 현상

#### INconsistency, 모순성

 다른 트랜잭션들이 해당 항목 값을 갱신하는 동안 한 트랜잭션이 두 개의 항목 값 중 어떤 것은 갱신되기 전의 값을 읽고 다른 것은 갱신된 후의 값을 읽게 되어 데이터의 불일치가 발생하는 상황

#### Cascading Rollback,  연쇄복귀

- 두 트랜잭션이 동일한 데이터 내용을 접근할 때 발생
- 한 트랜잭션이 데이터를 갱신한 다음 실패하여 Rollback 연산을 수행하는 과정에서 갱신과 Rollback 연산을 실행하고 있는 사이에 해당 데이터를 읽어서 사용할 때 발생할 수 있는 문제

#### Dirty Read, 현황파악오류

중간 수행 결과를 다른 트랜잭션이 참조하여 발생하는 오류



### 동시성 제어 기법

### Transaction Schedule

![](https://t1.daumcdn.net/cfile/tistory/997B3A415A2FC5E236)

트랜잭션 스케줄이란 그 연산들의 실행 순서를 의미



### Lock, 락

#### 로킹(Locking)

 트랜잭션들이 동일한 데이터 항목에 대해 임의적인 병행 접근을 하지 못하도록 제어하는 것

 여러 개의 트랜잭션들이 하나의 데이터로 동시에 접근하려고 할 때 이를 제어해주는 도구가 바로 Lock이다. 

락은 트랜잭션이 읽기를 할 때 사용하는 공유락(LS, Shared Lock)과 읽고 쓰기를 할 때 사용하는 배타락(LX, Exclusive Lock)으로 구성됨.

- 공유락과 베타락을 사용하는 규칙
  - 데이터에 락이 걸려있지 않으면 트랜잭션은 데이터에 락을 걸 수 있다.
  - 트랜잭션이 데이터 X를 읽기만 할 경우 LS(X)를 요청하고, 읽거나 쓸 경우 LX(X)를 요청한다.
  - 다른 트랜잭션이 데이터에 LS(X)를 걸어둔 경우, LS(X)의요청은 허용하고 LX(X)는 허용하지 않는다.
  - 다른 트랜잭션이 데이터에 LX(X)를 걸어둔 경우, LS(X)와 LX(X) 모두 허용하지 않는다.
  - 트랜잭션이 락을 허용받지 못하면 대기 상태가 된다.

#### 2단계 락킹

2단계 로킹 규약: 락을 걸고 해제하는 시점에 제한을 두지 않으면 두 개의 트랜잭션이 동시에 실행될 때 데이터의 일관성이 깨질 수 있어서 로킹 단계를 2개로 구분하여 이를 방지하는 방법

- 확장 단계(Growing Phase): 트랜잭션은 새로운 lock 연산만 할 수 있고, unlock 연산은 할 수 없는 단계
- 축소 단계(Shrinking Phase): 트랜잭션은 unlock 연산만 실행할 수 있고, lock 연산은 실행할 수 없는 단계

 2단계 로킹 규약(2PLP: Two-Phase Locking Protocol)은 트랜잭션들이 lock하는 시간과 unlock을 하는 시간을 구분하여 수행하도록 하는 것입니다.



### Timestamp Ordering, 타임스탬프 오더링

 고유 번호인 시간스탬프를 트랜잭션에 부여하는 것으로 트랜잭션 간의 순서를 미리 선택하고 동시성 제어의 기준으로 사용하는 기법

